---
phase: 01-foundation-authentication
plan: 03
type: execute
wave: 3
depends_on: ["01-01", "01-02"]
files_modified:
  - src/app/dashboard/page.tsx
  - src/app/dashboard/layout.tsx
  - src/components/layout/header.tsx
  - src/app/page.tsx
autonomous: false

must_haves:
  truths:
    - "Authenticated user sees dashboard with their name displayed"
    - "Dashboard shows summary of demo data (tenders count, bids count)"
    - "User can log out from dashboard via button in header"
    - "After logout, user is redirected to home page"
    - "Home page has clear calls-to-action for login and signup"
    - "Unauthenticated access to /dashboard redirects to /login"
  artifacts:
    - path: "src/app/dashboard/page.tsx"
      provides: "Protected dashboard page"
      contains: "verifySession"
    - path: "src/app/dashboard/layout.tsx"
      provides: "Dashboard layout with header"
    - path: "src/components/layout/header.tsx"
      provides: "App header with logout button"
      contains: "logout"
    - path: "src/app/page.tsx"
      provides: "Public landing page with auth CTAs"
  key_links:
    - from: "src/app/dashboard/page.tsx"
      to: "src/lib/dal.ts"
      via: "Session verification on load"
      pattern: "verifySession|getUser"
    - from: "src/components/layout/header.tsx"
      to: "src/actions/auth.ts"
      via: "Logout server action"
      pattern: "logout"
    - from: "src/app/page.tsx"
      to: "/login"
      via: "Navigation link"
      pattern: "href.*login"
---

<objective>
Create the protected dashboard page (first thing users see after login), app header with logout functionality, and a public landing page. This completes the full auth flow loop: landing -> signup/login -> dashboard -> logout -> landing.

Purpose: Close the auth loop so users can experience the complete authentication flow end-to-end. The dashboard is the authenticated home base; the landing page is the public entry point. Together they prove auth works.
Output: Working dashboard page (protected), header with logout, landing page with login/signup CTAs.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-authentication/01-RESEARCH.md
@.planning/phases/01-foundation-authentication/01-01-SUMMARY.md
@.planning/phases/01-foundation-authentication/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create protected dashboard page and app header with logout</name>
  <files>
    src/app/dashboard/page.tsx
    src/app/dashboard/layout.tsx
    src/components/layout/header.tsx
    src/app/page.tsx
  </files>
  <action>
    1. Create `src/components/layout/header.tsx` — app header component:
       - Server component (accesses session server-side)
       - Import { auth } from '@/lib/auth'
       - Import { logout } from '@/actions/auth'
       - Import Button from shadcn/ui
       - Display:
         - Left side: "BidFlow" text/logo (link to /dashboard if authenticated, / if not)
         - Right side (when authenticated): User name or email + Logout button
         - Logout button wraps the logout server action in a form:
           ```tsx
           <form action={logout}>
             <Button variant="ghost" type="submit">Sign out</Button>
           </form>
           ```
       - Styling: sticky top-0, white background, border-bottom, z-10, px-6, py-3, flex justify-between items-center

    2. Create `src/app/dashboard/layout.tsx` — dashboard layout:
       - Server component
       - Import and render Header component
       - Render children below header
       - This layout wraps all /dashboard/* routes

    3. Create `src/app/dashboard/page.tsx` — protected dashboard:
       - Server component
       - Import verifySession and getUser from '@/lib/dal'
       - Call verifySession() (redirects to /login if unauthenticated — DAL security, NOT middleware)
       - Call getUser() to get user details
       - Fetch summary stats from database:
         ```typescript
         const [tenderCount, bidCount] = await Promise.all([
           prisma.tender.count({ where: { status: 'OPEN' } }),
           prisma.bid.count(),
         ])
         ```
       - Display:
         - Welcome message: "Welcome back, {user.name || 'User'}"
         - Summary cards (using shadcn/ui Card):
           - "Open Tenders" card showing tenderCount
           - "Your Bids" card showing bidCount
           - "Company Profile" card (placeholder for Phase 2)
         - Cards should be in a responsive grid: 1 col on mobile, 3 cols on lg
       - This is a placeholder dashboard — future phases will add real functionality

    4. Update `src/app/page.tsx` — public landing page:
       - Server component
       - Check if user is authenticated (use auth() from @/lib/auth, but do NOT redirect)
       - If authenticated: show link/button to go to Dashboard
       - If not authenticated: show Login and Sign Up buttons/links
       - Content:
         - Heading: "BidFlow" (large)
         - Subheading: "Win more tenders. Spend less time on paperwork."
         - Brief description: "AI-powered bid generation platform for SMEs competing in EU public procurement."
         - Two CTA buttons: "Get Started" (link to /signup), "Sign In" (link to /login)
         - If already logged in: single "Go to Dashboard" button
       - Styling: centered content, clean and minimal, full viewport height
  </action>
  <verify>
    - `npm run build` passes
    - Visiting /dashboard while unauthenticated redirects to /login
    - Visiting /dashboard while authenticated shows welcome message with user name
    - Dashboard shows tender count and bid count from seed data
    - Logout button in header signs out and redirects to home page
    - Home page shows login/signup CTAs when unauthenticated
    - Home page shows "Go to Dashboard" when authenticated
  </verify>
  <done>
    Protected dashboard page shows welcome message, summary stats (open tenders, bids), and placeholder cards. App header displays on dashboard with user name and logout button. Landing page has BidFlow branding with login/signup CTAs. Full auth loop works: landing -> signup -> dashboard -> logout -> landing.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete Phase 1 authentication system:
    1. Next.js 15 project with all dependencies
    2. PostgreSQL database with full schema (User, Company, Tender, Bid)
    3. Seed data (demo user, company, 3 tenders, 1 bid)
    4. Auth.js v5 with credentials provider
    5. Login and signup pages with form validation
    6. Protected dashboard with summary stats
    7. Logout from header
    8. Landing page with CTAs
  </what-built>
  <how-to-verify>
    Start the dev server: `npm run dev`

    **Test 1: Landing Page**
    1. Visit http://localhost:3000
    2. Verify: See "BidFlow" heading, description, "Get Started" and "Sign In" buttons

    **Test 2: Signup Flow**
    1. Click "Get Started" (or visit /signup)
    2. Try submitting empty form — verify validation errors appear
    3. Enter: Name = "Test User", Email = "test@example.com", Password = "Test1234"
    4. Submit — verify redirect to /dashboard
    5. Verify: Dashboard shows "Welcome back, Test User"

    **Test 3: Session Persistence**
    1. Refresh the browser on /dashboard
    2. Verify: Still on dashboard, still shows user name (session persisted)

    **Test 4: Logout**
    1. Click "Sign out" in header
    2. Verify: Redirected to home page
    3. Visit /dashboard directly
    4. Verify: Redirected to /login (protected route)

    **Test 5: Login Flow**
    1. Visit /login
    2. Enter demo credentials: demo@bidflow.com / Demo1234!
    3. Submit — verify redirect to /dashboard
    4. Verify: Dashboard shows tender count (3) and bid count (1) from seed data

    **Test 6: Error Handling**
    1. Visit /login
    2. Enter wrong password: demo@bidflow.com / wrongpassword
    3. Verify: Error message shown, no crash

    **Test 7: Duplicate Signup**
    1. Visit /signup
    2. Enter: Name = "Dupe", Email = "demo@bidflow.com" (already exists), Password = "Test1234"
    3. Verify: Error message about email already existing
  </how-to-verify>
  <resume-signal>Type "approved" if all 7 tests pass, or describe which tests failed and what happened.</resume-signal>
</task>

</tasks>

<verification>
1. `npm run build` passes with zero errors
2. Full auth flow works: signup -> dashboard -> logout -> login -> dashboard
3. Session persists across browser refresh
4. Protected routes redirect unauthenticated users
5. Seed data visible on dashboard (tender count, bid count)
6. Error messages display correctly (wrong password, duplicate email)
7. Logout works from header on any dashboard page
</verification>

<success_criteria>
- Dashboard shows user name, open tender count, bid count
- Header displays on all dashboard pages with logout button
- Landing page has BidFlow branding and auth CTAs
- Full auth loop verified by human: landing -> signup -> dashboard -> refresh (persists) -> logout -> login -> dashboard
- All error cases handled gracefully
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-authentication/01-03-SUMMARY.md`
</output>
