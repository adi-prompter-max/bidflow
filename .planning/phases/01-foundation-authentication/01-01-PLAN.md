---
phase: 01-foundation-authentication
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - next.config.ts
  - tailwind.config.ts
  - postcss.config.mjs
  - src/app/layout.tsx
  - src/app/page.tsx
  - src/app/globals.css
  - src/lib/prisma.ts
  - prisma/schema.prisma
  - prisma/seed.ts
  - .env.local
  - .env.example
  - .gitignore
  - components.json
autonomous: true

must_haves:
  truths:
    - "Next.js dev server starts without errors on localhost:3000"
    - "Prisma schema validates and migration applies successfully"
    - "Database contains seed data (demo user, company, tenders, bids) after running seed"
    - "TypeScript compiles with zero errors in strict mode"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies and scripts"
      contains: "next-auth"
    - path: "prisma/schema.prisma"
      provides: "Database schema with all models"
      contains: "model User"
    - path: "prisma/seed.ts"
      provides: "Idempotent seed script with demo data"
      contains: "upsert"
    - path: "src/lib/prisma.ts"
      provides: "Prisma client singleton"
      contains: "PrismaClient"
    - path: ".env.example"
      provides: "Environment variable template"
      contains: "DATABASE_URL"
  key_links:
    - from: "prisma/seed.ts"
      to: "prisma/schema.prisma"
      via: "Prisma client using schema models"
      pattern: "prisma\\.(user|company|tender|bid)\\.upsert"
    - from: "src/lib/prisma.ts"
      to: "prisma/schema.prisma"
      via: "PrismaClient instantiation"
      pattern: "new PrismaClient"
---

<objective>
Bootstrap the BidFlow Next.js 15 project with all dependencies, Prisma database schema covering all MVP models, and idempotent seed data for immediate testing.

Purpose: Establish the technical foundation that all subsequent plans depend on — a running Next.js app with a fully-migrated PostgreSQL database containing demo data.
Output: A working Next.js 15 project with Prisma schema, applied migrations, and seed data (demo user, company, tenders, sample bids).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-authentication/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Next.js 15 project with all dependencies and toolchain</name>
  <files>
    package.json
    tsconfig.json
    next.config.ts
    tailwind.config.ts
    postcss.config.mjs
    src/app/layout.tsx
    src/app/page.tsx
    src/app/globals.css
    .gitignore
    components.json
  </files>
  <action>
    1. Initialize Next.js 15 project in the current directory (project root is /Users/adityapratapsingh/GSD):
       ```bash
       npx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir --import-alias "@/*" --use-npm
       ```
       NOTE: If the directory is non-empty, use `--yes` flag or handle the prompt. The `.planning/`, `.claude/`, `.git/` directories already exist.

    2. Verify Next.js version is >= 15.2.3 (critical for CVE-2025-29927 fix):
       ```bash
       npm ls next
       ```
       If version is below 15.2.3, upgrade: `npm install next@latest`

    3. Install core dependencies:
       ```bash
       npm install @prisma/client @auth/prisma-adapter next-auth@beta bcryptjs zod react-hook-form @hookform/resolvers
       ```

    4. Install dev dependencies:
       ```bash
       npm install --save-dev prisma @types/bcryptjs tsx
       ```

    5. Initialize shadcn/ui:
       ```bash
       npx shadcn@latest init -d
       ```
       This creates components.json and sets up the ui component directory.

    6. Add required shadcn/ui components for auth forms:
       ```bash
       npx shadcn@latest add button input label card form
       ```

    7. Update `next.config.ts` to use standard settings (no special config needed for Phase 1).

    8. Ensure `.gitignore` includes:
       - node_modules/
       - .next/
       - .env.local
       - .env*.local
       - Do NOT gitignore .planning/ or .claude/

    9. Verify the dev server starts:
       ```bash
       npm run dev
       ```
       Confirm it runs on localhost:3000 without errors, then stop it.
  </action>
  <verify>
    - `npm run build` completes without errors
    - `npm ls next` shows version >= 15.2.3
    - `ls src/components/ui/` shows button.tsx, input.tsx, label.tsx, card.tsx, form.tsx
    - `.gitignore` contains node_modules and .env.local
  </verify>
  <done>
    Next.js 15 project scaffolded with all dependencies installed (next-auth, prisma, bcryptjs, zod, react-hook-form, shadcn/ui). TypeScript strict mode enabled. Build passes. Dev server runs on localhost:3000.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Prisma schema with all MVP models and configure database</name>
  <files>
    prisma/schema.prisma
    src/lib/prisma.ts
    .env.local
    .env.example
  </files>
  <action>
    1. Create `.env.example` with placeholder values (committed to git):
       ```
       # Database
       DATABASE_URL="postgresql://user:password@localhost:5432/bidflow?schema=public"

       # Auth.js v5
       AUTH_SECRET="" # Generate with: openssl rand -base64 32
       AUTH_URL="http://localhost:3000"

       # Node
       NODE_ENV="development"
       ```

    2. Create `.env.local` with real local development values:
       - DATABASE_URL pointing to local PostgreSQL (use `postgresql://postgres:postgres@localhost:5432/bidflow` as default)
       - AUTH_SECRET: generate with `openssl rand -base64 32`
       - AUTH_URL: http://localhost:3000

    3. Create `prisma/schema.prisma` with ALL MVP models:

       ```prisma
       datasource db {
         provider = "postgresql"
         url      = env("DATABASE_URL")
       }

       generator client {
         provider = "prisma-client-js"
       }

       // === Auth.js Required Models ===

       model User {
         id            String    @id @default(cuid())
         name          String?
         email         String    @unique
         emailVerified DateTime?
         password      String    // For credentials auth
         image         String?
         accounts      Account[]
         sessions      Session[]
         companies     Company[]
         createdAt     DateTime  @default(now())
         updatedAt     DateTime  @updatedAt
       }

       model Account {
         id                String  @id @default(cuid())
         userId            String
         type              String
         provider          String
         providerAccountId String
         refresh_token     String? @db.Text
         access_token      String? @db.Text
         expires_at        Int?
         token_type        String?
         scope             String?
         id_token          String? @db.Text
         session_state     String?
         user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)
         @@unique([provider, providerAccountId])
       }

       model Session {
         id           String   @id @default(cuid())
         sessionToken String   @unique
         userId       String
         expires      DateTime
         user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
       }

       model VerificationToken {
         identifier String
         token      String   @unique
         expires    DateTime
         @@unique([identifier, token])
       }

       // === BidFlow Domain Models ===

       model Company {
         id             String   @id @default(cuid())
         name           String
         sector         String   // "IT" or "Construction"
         description    String?  @db.Text
         capabilities   String[] // Array of capability tags
         certifications String[] // Array of certification names
         ownerId        String
         owner          User     @relation(fields: [ownerId], references: [id], onDelete: Cascade)
         bids           Bid[]
         createdAt      DateTime @default(now())
         updatedAt      DateTime @updatedAt
       }

       model Tender {
         id          String       @id @default(cuid())
         title       String
         description String       @db.Text
         value       Float        // Estimated value in EUR
         deadline    DateTime
         sector      String       // "IT" or "Construction"
         source      String       @default("TED") // Data source
         status      TenderStatus @default(OPEN)
         requirements String?     @db.Text // JSON string of tender requirements
         documents    String?     @db.Text // JSON string of document references
         bids        Bid[]
         createdAt   DateTime     @default(now())
         updatedAt   DateTime     @updatedAt
       }

       model Bid {
         id        String    @id @default(cuid())
         tenderId  String
         companyId String
         status    BidStatus @default(DRAFT)
         content   Json?     // Structured bid content as JSON
         tender    Tender    @relation(fields: [tenderId], references: [id], onDelete: Cascade)
         company   Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
         createdAt DateTime  @default(now())
         updatedAt DateTime  @updatedAt
       }

       enum TenderStatus {
         OPEN
         CLOSED
         AWARDED
       }

       enum BidStatus {
         DRAFT
         IN_REVIEW
         FINALIZED
         SUBMITTED
       }
       ```

    4. Create `src/lib/prisma.ts` — Prisma client singleton (prevents hot-reload connection exhaustion):
       ```typescript
       import { PrismaClient } from '@prisma/client'

       const globalForPrisma = globalThis as unknown as {
         prisma: PrismaClient | undefined
       }

       export const prisma = globalForPrisma.prisma ?? new PrismaClient()

       if (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma
       ```

    5. Run initial migration:
       ```bash
       npx prisma migrate dev --name init
       ```
       This creates the migration files and applies them to the database.

    6. Generate Prisma client:
       ```bash
       npx prisma generate
       ```
  </action>
  <verify>
    - `npx prisma validate` exits with no errors
    - `npx prisma migrate status` shows all migrations applied
    - `npx prisma studio` opens without errors (open briefly to confirm, then close)
    - `.env.example` exists and does NOT contain real secrets
    - `.env.local` exists and IS in .gitignore
  </verify>
  <done>
    Prisma schema defines User, Account, Session, VerificationToken (Auth.js), Company, Tender, Bid (domain) models with proper relations and enums. Migration applied to PostgreSQL. Prisma client singleton created. Environment variables configured with .env.example template committed and .env.local gitignored.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create idempotent seed script with comprehensive demo data</name>
  <files>
    prisma/seed.ts
    package.json
  </files>
  <action>
    1. Create `prisma/seed.ts` with idempotent upsert operations:

       The seed script must create:

       a) **Demo user** (for immediate login testing):
          - email: demo@bidflow.com
          - password: Demo1234! (hashed with bcryptjs, 10 salt rounds)
          - name: "Demo User"

       b) **Demo company profile** (IT sector):
          - name: "TechBuild Solutions Ltd."
          - sector: "IT"
          - description: "Full-service IT consulting and software development firm specializing in cloud migration, cybersecurity, and digital transformation for public sector clients."
          - capabilities: ["Software Development", "Cloud Migration", "Cybersecurity", "IT Consulting", "Digital Transformation"]
          - certifications: ["ISO 27001", "Cyber Essentials Plus", "ISO 9001"]
          - owner: demo user

       c) **3 sample tenders** (mix of sectors and statuses):
          - IT tender (OPEN): "Digital Transformation Platform for NHS Trust" - value 750000, deadline 3 months from now
          - IT tender (OPEN): "Cybersecurity Audit and Remediation" - value 250000, deadline 2 months from now
          - Construction tender (OPEN): "School Building Renovation Programme" - value 1200000, deadline 4 months from now

       d) **1 example bid** (DRAFT status, linked to first tender):
          - tenderId: linked to "Digital Transformation Platform" tender
          - companyId: linked to demo company
          - status: DRAFT
          - content: JSON with executiveSummary, methodology, and teamExperience fields partially filled

       All operations MUST use `prisma.xxx.upsert()` with deterministic IDs (e.g., "demo-user-1", "demo-company-1", "tender-demo-1") so the script can be re-run safely.

       Use `where` clause on unique fields (email for User, id for others).

       Script structure:
       ```typescript
       import { PrismaClient } from '@prisma/client'
       import bcrypt from 'bcryptjs'

       const prisma = new PrismaClient()

       async function main() {
         console.log('Seeding database...')
         // ... upsert operations
         console.log('Seed complete.')
       }

       main()
         .catch((e) => { console.error(e); process.exit(1) })
         .finally(async () => { await prisma.$disconnect() })
       ```

    2. Add seed configuration to `package.json`:
       ```json
       "prisma": {
         "seed": "tsx prisma/seed.ts"
       }
       ```

    3. Run the seed script:
       ```bash
       npx prisma db seed
       ```

    4. Verify seed data exists:
       ```bash
       npx prisma studio
       ```
       Or use a quick script to count records.
  </action>
  <verify>
    - `npx prisma db seed` completes without errors
    - Running `npx prisma db seed` a second time also completes without errors (idempotent)
    - Database contains: 1 user, 1 company, 3 tenders, 1 bid
    - Demo user password hash is valid bcrypt (starts with $2a$ or $2b$)
  </verify>
  <done>
    Seed script creates demo user (demo@bidflow.com / Demo1234!), TechBuild Solutions company, 3 sample tenders (2 IT, 1 Construction), and 1 draft bid. Script is idempotent — safe to re-run. Seed command configured in package.json.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes with zero errors
2. `npx prisma validate` confirms schema is valid
3. `npx prisma migrate status` shows migrations applied
4. `npx prisma db seed` runs successfully (and re-runs without error)
5. Dev server starts on localhost:3000
6. All required files exist in correct locations
</verification>

<success_criteria>
- Next.js 15 (>= 15.2.3) project with TypeScript strict mode builds successfully
- All dependencies installed: next-auth, prisma, bcryptjs, zod, react-hook-form, shadcn/ui
- PostgreSQL database has all models: User, Account, Session, VerificationToken, Company, Tender, Bid
- Seed data present: 1 demo user, 1 company, 3 tenders, 1 bid
- Environment variables properly configured (.env.example committed, .env.local gitignored)
- Prisma client singleton prevents connection exhaustion in dev
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-authentication/01-01-SUMMARY.md`
</output>
