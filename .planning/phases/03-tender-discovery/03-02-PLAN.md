---
phase: 03-tender-discovery
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/app/dashboard/tenders/page.tsx
  - src/app/dashboard/tenders/components/tender-columns.tsx
  - src/app/dashboard/tenders/components/tender-table.tsx
  - src/app/dashboard/tenders/components/tender-filters.tsx
autonomous: true

must_haves:
  truths:
    - "User can browse a list of mock tenders showing title, sector, estimated value, and deadline"
    - "User can filter tenders by sector, value range, and deadline date"
    - "Tenders are sorted by relevance score by default"
    - "System displays tender relevance scores based on company profile match"
  artifacts:
    - path: "src/app/dashboard/tenders/page.tsx"
      provides: "Server Component page with filtered tender data"
      contains: "getTenders"
    - path: "src/app/dashboard/tenders/components/tender-table.tsx"
      provides: "TanStack Table client component with sorting"
      contains: "useReactTable"
    - path: "src/app/dashboard/tenders/components/tender-filters.tsx"
      provides: "Filter controls (sector, value, deadline)"
      contains: "useSearchParams"
    - path: "src/app/dashboard/tenders/components/tender-columns.tsx"
      provides: "Column definitions for tender table"
      contains: "ColumnDef"
  key_links:
    - from: "src/app/dashboard/tenders/page.tsx"
      to: "src/lib/tenders/queries.ts"
      via: "import getTenders"
      pattern: "getTenders"
    - from: "src/app/dashboard/tenders/page.tsx"
      to: "src/lib/tenders/filters.ts"
      via: "import parseFilters"
      pattern: "parseFilters"
    - from: "src/app/dashboard/tenders/components/tender-filters.tsx"
      to: "/dashboard/tenders"
      via: "router.replace with search params"
      pattern: "router\\.replace"
    - from: "src/app/dashboard/tenders/components/tender-table.tsx"
      to: "src/app/dashboard/tenders/components/tender-columns.tsx"
      via: "import tenderColumns"
      pattern: "tenderColumns"
---

<objective>
Build the tender discovery list page with TanStack Table, filter controls, and sortable columns showing title, sector, value, deadline, and relevance score.

Purpose: Deliver the core tender browsing and filtering experience (TEND-01, TEND-02, TEND-03 requirements).
Output: Fully functional /dashboard/tenders page with server-side filtering, client-side sorting, and relevance-based default ordering.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-tender-discovery/03-RESEARCH.md
@.planning/phases/03-tender-discovery/03-01-SUMMARY.md
@prisma/schema.prisma
@src/lib/dal.ts
@src/lib/prisma.ts
@src/app/dashboard/layout.tsx
@src/app/dashboard/page.tsx
@src/components/ui/table.tsx
@src/components/ui/select.tsx
@src/components/ui/input.tsx
@src/components/ui/badge.tsx
@src/components/ui/button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create tender column definitions and TanStack Table component</name>
  <files>
    src/app/dashboard/tenders/components/tender-columns.tsx
    src/app/dashboard/tenders/components/tender-table.tsx
  </files>
  <action>
    1. Create `src/app/dashboard/tenders/components/tender-columns.tsx`:
       - Define column array OUTSIDE any component (critical to avoid infinite re-render loop per RESEARCH.md Pitfall 1)
       - Import ColumnDef from @tanstack/react-table
       - Import Badge from @/components/ui/badge, format from date-fns, Button from @/components/ui/button
       - Import Link from next/link for clickable titles
       - Columns (in order):
         - **Title**: accessorKey "title", render as Link to `/dashboard/tenders/${row.original.id}` with hover underline styling
         - **Sector**: accessorKey "sector", render as Badge (variant: "secondary")
         - **Value**: accessorKey "value", header "Est. Value", format as EUR currency (`EUR ${value.toLocaleString()}`)
         - **Deadline**: accessorKey "deadline", format with date-fns `format(date, 'MMM dd, yyyy')`, show urgency color (red text if deadline < 14 days away, amber if < 30 days)
         - **Relevance**: accessorKey "relevanceScore", header "Match", render as percentage with color coding (green >= 70%, amber >= 40%, gray < 40%), show as `${Math.round(score)}%`
       - Each sortable column header should be clickable (use column.getToggleSortingHandler()) - wrap header text in a button with sort indicator arrow (lucide ArrowUpDown icon)
       - Export as `tenderColumns`
       - Export the TenderWithScore type import from queries (or define a display-safe version matching what server passes)

    2. Create `src/app/dashboard/tenders/components/tender-table.tsx`:
       - Mark as 'use client'
       - Import useReactTable, getCoreRowModel, getSortedRowModel, flexRender, SortingState from @tanstack/react-table
       - Import Table, TableBody, TableCell, TableHead, TableHeader, TableRow from @/components/ui/table
       - Import tenderColumns from ./tender-columns
       - Props: `{ data: TenderWithScore[] }`
       - Default sorting state: `[{ id: 'relevanceScore', desc: true }]` (relevance descending)
       - Render shadcn/ui Table with TanStack Table integration (see RESEARCH.md TanStack Table Implementation pattern)
       - Empty state: Show message "No tenders found matching your criteria. Try adjusting your filters or check back later for new opportunities." in a centered TableCell spanning all columns
       - Show total count above table: "{N} tenders found"
  </action>
  <verify>Run `npx tsc --noEmit` to verify no TypeScript errors in the new files.</verify>
  <done>Column definitions render title (as link), sector (badge), value (EUR), deadline (with urgency colors), and relevance (percentage with color). Table component uses TanStack Table with default relevance sorting and empty state handling.</done>
</task>

<task type="auto">
  <name>Task 2: Create filter controls and tenders list page</name>
  <files>
    src/app/dashboard/tenders/components/tender-filters.tsx
    src/app/dashboard/tenders/page.tsx
  </files>
  <action>
    1. Create `src/app/dashboard/tenders/components/tender-filters.tsx`:
       - Mark as 'use client'
       - Import useRouter, useSearchParams from next/navigation
       - Import Select, SelectContent, SelectItem, SelectTrigger, SelectValue from @/components/ui/select
       - Import Input from @/components/ui/input
       - Import Button from @/components/ui/button
       - Import X icon from lucide-react for clear filters
       - Create `updateFilter(key: string, value: string)` helper that creates new URLSearchParams from current, sets/deletes the key, and calls `router.replace(`/dashboard/tenders?${params.toString()}`, { scroll: false })`
       - Filter controls (horizontal row with flex gap-4, flex-wrap for mobile):
         - **Sector filter**: shadcn Select with options: "All Sectors" (value ""), "IT", "Construction". Read default from searchParams.get('sector').
         - **Min value filter**: Input type="number" with placeholder "Min value (EUR)", on blur update filter. Read from searchParams.get('minValue').
         - **Max value filter**: Input type="number" with placeholder "Max value (EUR)", on blur update filter. Read from searchParams.get('maxValue').
         - **Deadline filter**: Input type="date" with label "Deadline after", on change update filter. Read from searchParams.get('deadline').
         - **Clear all button**: Only show when any filter is active. Resets URL to `/dashboard/tenders` (no params). Use X icon + "Clear filters" text.
       - Show active filter count badge next to "Filters" label if any filters active

    2. Create `src/app/dashboard/tenders/page.tsx`:
       - This is a Server Component (NO 'use client')
       - Import Suspense from react
       - Import verifySession from @/lib/dal
       - Import getTenders from @/lib/tenders/queries
       - Import parseFilters from @/lib/tenders/filters
       - Import TenderTable from ./components/tender-table
       - Import TenderFilters from ./components/tender-filters
       - Page receives `searchParams: Promise<{ [key: string]: string | string[] | undefined }>` prop (Next.js 16 async searchParams)
       - Await searchParams, parse with parseFilters()
       - Verify session, get userId
       - Fetch tenders with `getTenders(filters, session.userId)`
       - Layout:
         - Page header: h1 "Tender Opportunities" + subtitle "Discover tenders matched to your company profile"
         - Wrap TenderFilters in Suspense boundary (RESEARCH.md Pitfall 2) with fallback div
         - TenderTable with data prop
       - Container styling: match dashboard page pattern (`container mx-auto px-6 py-8`)
  </action>
  <verify>
    1. Run `npx tsc --noEmit` for type checking
    2. Run `npm run build` to verify the page builds without errors
    3. Start dev server and navigate to /dashboard/tenders - should show tender list with filters
  </verify>
  <done>Tenders page at /dashboard/tenders shows filterable list of tenders with sector, value range, and deadline filters. Filters update URL search params. Table sorts by relevance by default. All filter combinations work correctly.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npm run build` completes successfully
3. Navigate to /dashboard/tenders - see list of 50+ tenders
4. Click sector filter to "IT" - only IT tenders shown
5. Set min value to 100000 - only tenders >= 100k shown
6. Set deadline filter - only tenders with deadline after that date shown
7. Clear filters button resets all filters
8. Relevance column shows percentages, table sorted by relevance by default
9. Click column headers to re-sort
10. Title links navigate to /dashboard/tenders/[id] (404 expected until Plan 03)
</verification>

<success_criteria>
- /dashboard/tenders page renders list of tenders from database
- Sector, value range, and deadline filters work via URL search params
- Table sorted by relevance score (descending) by default
- Column headers are sortable (clickable)
- Relevance scores displayed as colored percentages
- Deadlines show urgency coloring (red < 14 days, amber < 30 days)
- Empty state shown when no tenders match filters
- Filters preserve state in URL (shareable/bookmarkable)
</success_criteria>

<output>
After completion, create `.planning/phases/03-tender-discovery/03-02-SUMMARY.md`
</output>
