---
phase: 02-company-profiling
plan: 04
type: execute
wave: 4
depends_on: ["02-03"]
files_modified:
  - src/components/profile/completeness-card.tsx
  - src/app/dashboard/page.tsx
  - src/app/dashboard/profile/page.tsx
autonomous: false

must_haves:
  truths:
    - "Dashboard shows a profile completeness checklist card with section status"
    - "Checklist card links to the wizard for incomplete profiles"
    - "Profile view page shows all company data organized by section"
    - "User can navigate to edit each section from the profile page"
    - "Profile data displays correctly across sessions"
  artifacts:
    - path: "src/components/profile/completeness-card.tsx"
      provides: "Dashboard checklist card showing profile completion status"
    - path: "src/app/dashboard/page.tsx"
      provides: "Updated dashboard with completeness card"
    - path: "src/app/dashboard/profile/page.tsx"
      provides: "Profile view/edit page with all sections"
  key_links:
    - from: "src/components/profile/completeness-card.tsx"
      to: "src/actions/profile.ts"
      via: "getProfileCompleteness for status data"
      pattern: "getProfileCompleteness"
    - from: "src/app/dashboard/profile/page.tsx"
      to: "src/actions/profile.ts"
      via: "getCompanyProfile for full profile data"
      pattern: "getCompanyProfile"
    - from: "src/app/dashboard/page.tsx"
      to: "src/components/profile/completeness-card.tsx"
      via: "Renders completeness card in dashboard grid"
      pattern: "CompletenessCard"
---

<objective>
Build the dashboard profile completeness card and the dedicated profile view/edit page, completing the Phase 2 feature set.

Purpose: The completeness card is the primary CTA driving users to complete their profile. The profile page is where users view and edit their profile after initial wizard completion. Together these close the loop: dashboard nudges completion, wizard captures data, profile page displays and allows editing.

Output: Updated dashboard with completeness card, dedicated profile page with section-organized data display and edit navigation.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-company-profiling/02-CONTEXT.md
@.planning/phases/02-company-profiling/02-RESEARCH.md
@.planning/phases/02-company-profiling/02-03-SUMMARY.md
@src/app/dashboard/page.tsx
@src/actions/profile.ts
@src/lib/validations/profile.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create completeness card and update dashboard</name>
  <files>
    src/components/profile/completeness-card.tsx
    src/app/dashboard/page.tsx
  </files>
  <action>
    **Completeness Card** (`src/components/profile/completeness-card.tsx`):
    - Server component (fetches data on server side)
    - Calls `getProfileCompleteness()` to get step status
    - UI: A Card component with:
      - Title: "Company Profile" with percentage badge (e.g., "60%" in a Badge)
      - Checklist of 5 items, each with a check icon (green) or missing icon (gray/red):
        1. Company Info (check if companyInfo step complete)
        2. Industry Sectors (check if sectors step complete)
        3. Capabilities & Tags (check if capabilities step complete)
        4. Certifications (check if certifications step complete)
        5. Past Projects (check if projects step complete)
      - Each item text format: "Check Company Info" or "X Company Info" (using Unicode check/cross or simple color coding)
      - Per user decision: checklist stays visible even at 100% (serves as quick profile overview)
      - Bottom of card: If not 100% complete, show "Complete your profile" link to `/dashboard/profile/wizard`
      - If 100% complete, show "View profile" link to `/dashboard/profile`
    - Keep the card self-contained (async server component that does its own data fetching)

    **Update Dashboard** (`src/app/dashboard/page.tsx`):
    - Replace the existing static "Company Profile" card (the placeholder saying "Coming in Phase 2") with the CompletenessCard component
    - Import and render `<CompletenessCard />` in the dashboard grid
    - Keep the existing Open Tenders and Your Bids cards as-is
    - The completeness card should be in the same grid layout (third card position)

    **Profile View/Edit Page** (`src/app/dashboard/profile/page.tsx`):
    - Server component, verifies session via DAL
    - Fetches full company profile via `getCompanyProfile()`
    - If no company exists, redirect to wizard: `/dashboard/profile/wizard`
    - Layout: Section-based display using Cards for each profile area:

      **Section 1: Company Information**
      - Display: name, country, size, website, description
      - "Edit" link that navigates to `/dashboard/profile/wizard?step=1`

      **Section 2: Industry Sectors**
      - Display: selected sectors as Badges, sub-categories listed below each
      - "Edit" link → `/dashboard/profile/wizard?step=2`

      **Section 3: Capabilities**
      - Display: capability description text, tags as Badge chips
      - "Edit" link → `/dashboard/profile/wizard?step=3`

      **Section 4: Certifications**
      - Display: list of certifications with name, issuing body, dates
      - "Edit" link → `/dashboard/profile/wizard?step=4`

      **Section 5: Past Projects**
      - Display: table of projects with name, client, sector, value, year
      - "Edit" link → `/dashboard/profile/wizard?step=5`

    - Page header: "Company Profile" title with "Edit Profile" button linking to wizard
    - Each section is a Card with CardHeader (section title + edit link) and CardContent (data display)
    - Handle empty/missing sections gracefully: show "Not yet completed" with link to relevant wizard step
    - Use Separator between sections for visual clarity

    **Update wizard Finish button** (if needed): After completing step 5, redirect to `/dashboard/profile` instead of `/dashboard`.
  </action>
  <verify>
    - Dashboard at `/dashboard` shows completeness card with checklist
    - Completeness card shows correct check/missing status for each step
    - "Complete your profile" link goes to wizard
    - After completing all steps, card shows 100% with all checks
    - Profile page at `/dashboard/profile` shows all sections with data
    - Each section's "Edit" link navigates to correct wizard step
    - Empty profile redirects to wizard from profile page
    - `npm run build` succeeds
  </verify>
  <done>
    Dashboard shows completeness card with 5-item checklist and percentage. Profile page displays all profile data in organized sections with edit links to wizard steps. Complete auth -> dashboard -> wizard -> profile page flow works end-to-end.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete company profiling feature for Phase 2:
    - 5-step wizard at /dashboard/profile/wizard (Company Info, Sectors, Capabilities, Certifications, Past Projects)
    - Auto-save on blur/change for all form fields
    - Progress bar tracking completion
    - Tag input with keyboard support for capabilities
    - Inline certification management (add/edit/delete)
    - Past projects table with modal dialog for add/edit
    - Dashboard completeness checklist card
    - Profile view page at /dashboard/profile with all sections
  </what-built>
  <how-to-verify>
    1. Start the dev server: `npm run dev`
    2. Log in (demo@bidflow.com / Demo1234!) or create a new account
    3. Dashboard should show the profile completeness card with checklist (demo user may already have some data)
    4. Click "Complete your profile" to open the wizard
    5. **Step 1**: Fill in company info (name, country, size). Tab between fields and observe auto-save (brief "Saved" indicator)
    6. Click "Next" to go to Step 2
    7. **Step 2**: Check "IT & Software" — sub-categories should appear. Select some sub-categories. Check "Construction" too if desired.
    8. Click "Next" to Step 3
    9. **Step 3**: Type a capability description. Add tags by typing and pressing Enter. Remove a tag with the X button. Verify character counter works.
    10. Click "Next" to Step 4
    11. **Step 4**: Click "Add Certification". Fill in name, issuing body, dates. Save. Edit the certification. Delete it.
    12. Click "Next" to Step 5
    13. **Step 5**: Click "Add Project". Fill in all fields in the modal. Save. Verify project appears in table. Edit it. Delete it.
    14. Click "Finish" — should navigate to profile page
    15. **Profile page**: Verify all sections display the data you entered
    16. Click an "Edit" link on any section — should go to correct wizard step with data pre-populated
    17. Navigate to Dashboard — completeness card should reflect current status
    18. Refresh the page — all data should persist

    **Check for:**
    - Smooth navigation between wizard steps (no page reloads)
    - Data persistence across visits
    - Responsive layout on different screen widths
    - No console errors
    - All form validations working (try submitting empty required fields)
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
- Dashboard completeness card shows accurate step-by-step status
- Profile page displays all 5 sections with data or empty state
- Edit links navigate to correct wizard steps
- Complete end-to-end flow: dashboard → wizard → fill all steps → profile page → edit via wizard
- Data persists across page refreshes and new sessions
- `npm run build` succeeds
</verification>

<success_criteria>
- Dashboard's "Company Profile" card shows real completeness data (not the Phase 2 placeholder)
- Profile page at /dashboard/profile displays all company data in organized sections
- User can edit any section by clicking through to the appropriate wizard step
- Full wizard walkthrough from empty profile to 100% complete works without errors
- All Phase 2 success criteria from ROADMAP.md are met:
  1. User can select industry sectors (IT & Software, Construction) -- Step 2
  2. User can describe capabilities using free-text descriptions and tags -- Step 3
  3. User can add certifications (ISO, security clearances, industry-specific) -- Step 4
  4. User can add past projects with descriptions and references -- Step 5
  5. Profile data persists and displays correctly across sessions -- Profile page + dashboard card
</success_criteria>

<output>
After completion, create `.planning/phases/02-company-profiling/02-04-SUMMARY.md`
</output>
